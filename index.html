<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Enquiry Log</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial; background:#f4f6f8; padding:10px }
h2 { margin-bottom:4px }
.header-ref { font-size:12px; font-weight:bold; margin-bottom:10px }
button { background:#0b2c5d; color:#fff; border:none; padding:8px; width:100%; margin:5px 0; cursor:pointer }
table { width:100%; border-collapse:collapse; background:#fff; font-size:12px }
th,td { border:1px solid #ccc; padding:5px; text-align:center }
th { background:#e9eef5 }
input,select { width:100%; box-sizing:border-box; padding:4px }
.locked { background:#eee }
.sub { background:#f9f9f9 }
.reminder { color:red; font-weight:bold; cursor:pointer }
.filters { display:flex; gap:5px; flex-wrap:wrap; margin-bottom:5px }
</style>
</head>

<body>

<h2>Enquiry Log – January 2026</h2>
<div class="header-ref">IRS-FORM-13-01</div>

<button onclick="addMain()">➕ Add Main Quote</button>
<button onclick="downloadExcel()">⬇️ Download Excel</button>

<table>
<thead>
<tr>
<th>Sl</th>
<th>Quote No</th>
<th>Type</th>
<th>Project</th>
<th>Manager</th>
<th>Candidate</th>
<th>Deadline</th>
<th>Status</th>
<th>Value</th>
<th>Add</th>
</tr>
</thead>
<tbody id="body"></tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script>
/* CONFIG */
const STORAGE="ENQUIRY_JAN_2026";
const QUOTE_START=8669;
const managers=["Mr. Vishal","Mr. Mukesh","Mr. Irshad","Mr. Prem","Ms. Tania","Mr. Robbin"];
const candidates={
  "Praneeth":"estimation@insides.ae",
  "Chetaka":"estimation2@insides.ae"
};

let rows=JSON.parse(localStorage.getItem(STORAGE))||[];

/* NEXT MAIN QUOTE */
function nextMain(){
  const mains=rows.filter(r=>r.type==="Main").map(r=>+r.base);
  return mains.length?Math.max(...mains)+1:QUOTE_START;
}

/* ADD MAIN */
function addMain(){
  const base=nextMain();
  rows.push({
    base,
    quote:String(base),
    type:"Main",
    project:"",
    manager:"",
    candidate:"",
    deadline:"",
    status:"Not Started",
    value:""
  });
  save();
}

/* ADD SUB (A / R) */
function addSub(base,type){
  const count=rows.filter(r=>r.base===base && r.type===type).length+1;
  rows.push({
    base,
    quote:`${base}-${type[0]}${count}`,
    type,
    project:"",
    manager:"",
    candidate:"",
    deadline:"",
    status:"Not Started",
    value:""
  });
  save();
}

/* SAVE */
function save(){
  localStorage.setItem(STORAGE,JSON.stringify(rows));
  render();
}

/* RENDER */
function render(){
  const b=document.getElementById("body");
  b.innerHTML="";
  rows.forEach((r,i)=>{
    const locked=r.status==="Submitted";
    b.innerHTML+=`
<tr class="${r.type!=="Main"?"sub":""}">
<td>${i+1}</td>
<td>${r.quote}</td>
<td>${r.type}</td>
<td><input ${locked?"disabled class=locked":""} value="${r.project}" oninput="upd(${i},'project',this.value)"></td>
<td>
<select ${locked?"disabled":""} onchange="upd(${i},'manager',this.value)">
<option></option>${opt(managers,r.manager)}
</select>
</td>
<td>
<select ${locked?"disabled":""} onchange="upd(${i},'candidate',this.value)">
<option></option>${opt(Object.keys(candidates),r.candidate)}
</select>
</td>
<td><input ${locked?"disabled":""} type="date" value="${r.deadline}" onchange="upd(${i},'deadline',this.value)"></td>
<td>
<select onchange="upd(${i},'status',this.value)">
<option ${r.status=="Not Started"?"selected":""}>Not Started</option>
<option ${r.status=="Working"?"selected":""}>Working</option>
<option ${r.status=="Submitted"?"selected":""}>Submitted</option>
</select>
</td>
<td><input ${locked?"disabled class=locked":""} type="number" value="${r.value}" oninput="upd(${i},'value',this.value)"></td>
<td>
${r.type==="Main"?
`<button onclick="addSub(${r.base},'Additional')">A+</button>
 <button onclick="addSub(${r.base},'Revision')">R+</button>`:""}
</td>
</tr>`;
  });
}

/* UPDATE */
function upd(i,k,v){ rows[i][k]=v; save(); }

/* OPTIONS */
function opt(arr,val){
return arr.map(o=>`<option ${o===val?"selected":""}>${o}</option>`).join("");
}

/* EXCEL */
function downloadExcel(){
  const ws=XLSX.utils.json_to_sheet(rows.map((r,i)=>({
    "Sl.No":i+1,
    "Quote No":r.quote,
    "Type":r.type,
    "Project":r.project,
    "Manager":r.manager,
    "Candidate":r.candidate,
    "Deadline":r.deadline,
    "Status":r.status,
    "Value":r.value
  })));
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"January 2026");
  XLSX.writeFile(wb,"Enquiry_Jan_2026.xlsx");
}

render();
</script>

</body>
</html>
